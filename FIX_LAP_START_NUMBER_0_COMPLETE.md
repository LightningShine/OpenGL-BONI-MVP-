# ? ??????????: LAP_START_NUMBER = 0 ?????? ???????? ?????????

## ????????? ???????? (4 ??):

### 1. ? **??????????? ???????: `if (crossingTime > 1.0f)`** 
**????:** `RaceManager.cpp`, ?????? 120  
**????????:** ???? ??????????? ?????? ???? ????? > 1 ???????!

**?????? ??? ???????? ??? LAP_START_NUMBER = 0:**
```
LAP_START_NUMBER = 0:
?? ?????? ????????? ?? ?????? (progress = 0.0)
?? ?????? ???????????: ?????????? Lap 0
?? Lap 0 ????? ???? ????? ???????? (????????, 0.2 ???????)
?? ? ?????????: ???? ?? ???????????! ?

?????????:
- completedLaps ????????? = 0
- ????????? ???? ?? ?????????
- UI ????????? ????????
```

**???????:**
```cpp
// ????:
if (crossingTime > 1.0f)  // ? ???????!

// ?????:
const float MIN_VALID_LAP_TIME = 0.1f;  // 100ms ???????
if (crossingTime > MIN_VALID_LAP_TIME)  // ? ?????? ?????? ?? ?????? ???????????
```

---

### 2. ? **Best Lap ?? ???????? LAP_START_NUMBER**
**????:** `RaceManager.cpp`, ?????? 471 (GetVehicleBestLapTime)  
**????????:** ??????? `if (completedLaps < 2)` ?? ??????? ??? LAP_START_NUMBER = 0

**??????:**
```
LAP_START_NUMBER = 0:
?? ????? Lap 0: completedLaps = 1
?? ?????? ??????????: LAST = Lap 0, BEST = Lap 0 ?
?? ????: LAST = Lap 0, BEST = ???????? ? (??-?? completedLaps < 2)

LAP_START_NUMBER = 1:
?? ????? Lap 1: completedLaps = 1
?? ?????? ??????????: LAST = Lap 1, BEST = ???????? ?
?? ?????? ???? ????, ??? ? ??? ??????????
```

**???????:**
```cpp
// ????:
if (it->second.completedLaps < 2)  // ? ???????
    return -1.0f;

// ?????:
int minCompletedLaps = (RaceConstants::LAP_START_NUMBER == 0) ? 1 : 2;
if (it->second.completedLaps < minCompletedLaps)  // ? ???????????
    return -1.0f;
```

---

### 3. ? **GetVehiclePreviousLapTime() ????? ?????????????? ????**
**????:** `RaceManager.cpp`, ?????? 503 (GetVehiclePreviousLapTime)  
**????????:** ????? ??????? ????? ????? lap ? ??????? `-1`

**??????:**
```
LAP_START_NUMBER = 0:
?? ?????? ????????? Lap 0
?? currentLapNumber = 1 (????????? ????)
?? ???? previousLapNumber = 1 - 1 = 0 ?
?? ?? ???? LAP_START_NUMBER = 0 ? currentLapNumber = 0:
    ?? previousLapNumber = 0 - 1 = -1 ? (?? ??????????!)

LAP_START_NUMBER = 1:
?? ?????? ????????? Lap 1
?? currentLapNumber = 2
?? ???? previousLapNumber = 2 - 1 = 1 ?
?? ?? ???? currentLapNumber = 1:
    ?? previousLapNumber = 1 - 1 = 0 ? (????? 0 ??? ??? LAP_START_NUMBER = 1!)
```

**???????:**
```cpp
// ????:
int previousLapNumber = timing.currentLapNumber - 1;
auto lapIt = timing.laps.find(previousLapNumber);  // ? ????? ?????? -1 ??? 0

// ?????:
int previousLapNumber = timing.currentLapNumber - 1;

// ? ??????: ?? ???? ????? ?????? LAP_START_NUMBER
if (previousLapNumber < RaceConstants::LAP_START_NUMBER)
    return -1.0f;  // ??? ??????????? ?????

auto lapIt = timing.laps.find(previousLapNumber);
```

---

### 4. ? **bestLapTime ?? ?????????? ??? ?????? ?????**
**????:** `RaceManager.cpp`, ?????? 128  
**????????:** `if (crossingTime < timing.bestLapTime)` ?? ?????????? ????? `bestLapTime = -1.0f`

**??????:**
```
?????????????: bestLapTime = -1.0f

????? Lap 0 (83.456 ???):
?? ????????: 83.456 < -1.0f? ? FALSE ?
?? bestLapTime ???????? = -1.0f ?

?????????:
- Best Lap ?????????? ???????? ???? ????? 1 ?????
```

**???????:**
```cpp
// ????:
if (crossingTime < timing.bestLapTime)  // ? ?? ???????? ? -1.0f

// ?????:
if (crossingTime < timing.bestLapTime || timing.bestLapTime < 0.0f)  // ? ????????? -1
```

---

## ?????????:

### ????: `OpenGL\src\racing\RaceManager.cpp`

**1. ????? ??????? 1.0f (?????? 120):**
```cpp
// ????:
if (crossingTime > 1.0f)  // ? ???????

// ?????:
const float MIN_VALID_LAP_TIME = 0.1f;  // 100ms ???????
if (crossingTime > MIN_VALID_LAP_TIME)  // ?
```

**2. ?????????? ?????????? bestLapTime (?????? 131):**
```cpp
// ????:
if (crossingTime < timing.bestLapTime)  // ?

// ?????:
if (crossingTime < timing.bestLapTime || timing.bestLapTime < 0.0f)  // ?
```

**3. GetVehicleBestLapTime() ?????? ????????? LAP_START_NUMBER (?????? 463):**
```cpp
// ????:
if (it->second.completedLaps < 2)  // ? ???????

// ?????:
int minCompletedLaps = (RaceConstants::LAP_START_NUMBER == 0) ? 1 : 2;
if (it->second.completedLaps < minCompletedLaps)  // ?
```

**4. GetStandingsInternal() ?? ?? ????? (?????? 331):**
```cpp
// ????:
standing.bestLapTime = (timing.completedLaps >= 2) ? timing.bestLapTime : -1.0f;  // ?

// ?????:
int minCompletedLaps = (RaceConstants::LAP_START_NUMBER == 0) ? 1 : 2;
standing.bestLapTime = (timing.completedLaps >= minCompletedLaps) ? timing.bestLapTime : -1.0f;  // ?
```

**5. GetVehiclePreviousLapTime() ?????? ?? ????????????? ??????? (?????? 496):**
```cpp
// ????:
int previousLapNumber = timing.currentLapNumber - 1;
auto lapIt = timing.laps.find(previousLapNumber);  // ? ????? ???? -1

// ?????:
int previousLapNumber = timing.currentLapNumber - 1;

// ? ??????
if (previousLapNumber < RaceConstants::LAP_START_NUMBER)
    return -1.0f;

auto lapIt = timing.laps.find(previousLapNumber);  // ?
```

---

## ????????? ??????:

### LAP_START_NUMBER = 0 (??????????? ?????????):

**??????:**
```
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 0 (offset: 0.016s)

UI Lap Timer:
LAPTIME:      00:05.123
LAST LAP:     --:--:---  ?
BEST LAP:     --:--:---  ?
DELTA:        00.000
```

**????? Lap 0 (????? ???????? ???? - 0.5 ???????):**
```
[RACE MANAGER] Vehicle #1 completed Lap 0 in 0.523 seconds | Total completed laps: 1
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 1 (offset: 0.012s)

UI Lap Timer:
LAPTIME:      00:15.234
LAST LAP:     00:00.523  ? Lap 0 ?????????!
BEST LAP:     00:00.523  ? ???????????? ????? 1 ?????!
DELTA:        +14.711    ? ????????!
```

**????? Lap 1 (?????? ???? - 83.456 ???????):**
```
[RACE MANAGER] Vehicle #1 completed Lap 1 in 83.456 seconds | Total completed laps: 2
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 2 (offset: 0.014s)

UI Lap Timer:
LAPTIME:      00:08.123
LAST LAP:     01:23.456  ? Lap 1
BEST LAP:     00:00.523  ? Lap 0 (????? ???????)
DELTA:        +07.600    ? ????????? ? best (Lap 0)
```

---

### LAP_START_NUMBER = 1 (??? ? ???????? ??????):

**??????:**
```
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 1 (offset: 0.016s)

UI Lap Timer:
LAPTIME:      00:05.123
LAST LAP:     --:--:---  ?
BEST LAP:     --:--:---  ?
```

**????? Lap 1:**
```
[RACE MANAGER] Vehicle #1 completed Lap 1 in 83.456 seconds | Total completed laps: 1
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 2 (offset: 0.012s)

UI Lap Timer:
LAPTIME:      00:15.234
LAST LAP:     01:23.456  ?
BEST LAP:     --:--:---  ? ???????? (??? ? ??? ??????????)
DELTA:        00.000
```

**????? Lap 2:**
```
[RACE MANAGER] Vehicle #1 completed Lap 2 in 81.234 seconds | Total completed laps: 2
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 3 (offset: 0.014s)

UI Lap Timer:
LAPTIME:      00:08.123
LAST LAP:     01:21.234  ? Lap 2
BEST LAP:     01:21.234  ? ???????? ????? 2 ??????!
DELTA:        -13.111    ? ??????? (???????)
```

---

## ??????? ?????????:

| ????? | ????? 1 ????? | ????? 2 ?????? | ?????? |
|-------|---------------|----------------|--------|
| **LAP_START_NUMBER = 0** | LAST = Lap 0<br>BEST = Lap 0 ? | LAST = Lap 1<br>BEST = ?????? ?? 0 ? 1 | Lap 0 ????????? ???????? ?????? |
| **LAP_START_NUMBER = 1** | LAST = Lap 1<br>BEST = ???????? ? | LAST = Lap 2<br>BEST = ?????? ?? 1 ? 2 | ????? 2 ????? ??? ????????? |

---

## ?????????????? ??????:

### 1. MIN_VALID_LAP_TIME = 0.1f (100ms)
**?????? ??:** ?????? ??????????? ?????? ??? ???????? ??????

**??????:**
```
?????? ????????? ?? ?????? (progress = 0.0):
?? Frame 1: progress = 0.001 (?????? ????????)
?? Frame 2: progress = 0.995 (????? ????)
?? Frame 3: progress = 0.002 (???????????!) ? lapTime = 0.033s
?? ? MIN_VALID_LAP_TIME: ???? ?? ???????????? ?
```

### 2. ???????? `previousLapNumber >= LAP_START_NUMBER`
**?????? ??:** ?????? ?????????????? ????????????? ??????

**??????:**
```
LAP_START_NUMBER = 0, currentLapNumber = 0:
?? previousLapNumber = 0 - 1 = -1
?? ????????: -1 < 0? ? TRUE ? return -1.0f ?

LAP_START_NUMBER = 1, currentLapNumber = 1:
?? previousLapNumber = 1 - 1 = 0
?? ????????: 0 < 1? ? TRUE ? return -1.0f ?
```

### 3. ?????????? bestLapTime ? ?????? -1.0f
**?????? ??:** ???????? ??????? ?????

**??????:**
```
bestLapTime = -1.0f (????????? ????????)
Lap 0 ????????: 83.456s

????????: (83.456 < -1.0f || -1.0f < 0.0f)
         = (false || true)
         = true ?

bestLapTime = 83.456s ?
```

---

## ? ?????????:

- [x] ?????????? ???????
- [x] LAP_START_NUMBER = 0: ?????? ???? ????????????
- [x] LAP_START_NUMBER = 0: ????? 1 ????? ???????????? BEST LAP
- [x] LAP_START_NUMBER = 0: TIME DIFF ????????
- [x] LAP_START_NUMBER = 1: ????? 1 ????? ???????? ? BEST LAP
- [x] LAP_START_NUMBER = 1: ????? 2 ?????? ???????????? BEST LAP
- [x] ?????? ?? ?????? ??????????? (MIN_VALID_LAP_TIME)
- [x] ?????? ?? ????????????? ??????? ??????
- [x] ????? ???? ???????
- [x] ??? ????????????? ??? ????? ???????

---

## ?? ??????!

?????? LAP_START_NUMBER = 0 ???????? ?? 100%:
- ? ?????? ???? (???? ????? ????????) ????????????
- ? Best Lap ???????????? ????? 1 ?????
- ? Last Lap ???????????? ????? 1 ?????
- ? Time Diff ???????? ?????????
- ? ??? ????????
- ? ????????????? ?????? ??? ????? ???????

**?????????? ???????, ?????? ? ?????????????!** ??
