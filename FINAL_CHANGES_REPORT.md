# ? ????????? ????????? - ????????? ?????

## 1. ? ????????? ?????? ???????? ??????????? ????????????

**????????:** `OpenGL\src\vehicle\Vehicle.cpp` (?????? 251-268)

**???? (? ???????????????? ????????????):**
```cpp
float targetAngle = std::atan2(direction.y, direction.x) - glm::half_pi<float>();
const float smoothingFactor = 0.3f;
// ... ??????? ?????? ??????????? ...
rotationAngle = vehicle.m_smoothed_rotation;
```

**????? (????? ?????? ???????? - ?????? ??????????):**
```cpp
// ? ?????? ?????????? ???? (??? ??????????? - ????? ?????? ????????)
rotationAngle = std::atan2(direction.y, direction.x) - glm::half_pi<float>();
```

**?????????:**
- ??????????? ????????? ?????????????? ? ??????????? ????????
- ??? ????????, ??? "??????????"
- ????????? ??????????, ??? ???? ??????????

---

## 2. ? ?????????? ???? - ????????????? ?????????

### A. ???? ?????? ??????
**????:** `OpenGL\src\input\VehicleFocus_Input_MultiDigit.txt` (?????? 37)

??? ?????????:
```cpp
std::cout << "[FOCUS] Enter vehicle ID within 10 seconds (digits 0-9, then ENTER)..." << std::endl;
```
? ?? ???????????? "1-9", ???????????? ????? ID

### B. ???? ?????? ?????
**????????:** `OpenGL\src\racing\RaceManager.cpp` (?????? 182-186)

**????:**
```cpp
std::cout << "[RACE MANAGER] Vehicle #" << vehicleID 
          << " started first lap (offset: " << timing.currentLapTimer << "s)" << std::endl;
```

**????? (?????????????):**
```cpp
// ? ????????????? ????????? ??????????? LAP_START_NUMBER
std::cout << "[RACE MANAGER] Vehicle #" << vehicleID 
          << " crossed start/finish line, starting Lap " << timing.currentLapNumber 
          << " (offset: " << timing.currentLapTimer << "s)" << std::endl;
```

**??????? ??????:**

**LAP_START_NUMBER = 0:**
```
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 0 (offset: 0.016s)
[RACE MANAGER] Vehicle #1 completed Lap 0 in 83.456 seconds
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 1 (offset: 0.012s)
```

**LAP_START_NUMBER = 1:**
```
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 1 (offset: 0.016s)
[RACE MANAGER] Vehicle #1 completed Lap 1 in 83.456 seconds
[RACE MANAGER] Vehicle #1 crossed start/finish line, starting Lap 2 (offset: 0.012s)
```

? ??? ?????? ????????????? ? ?????????? ???????? ????? ?????

---

## 3. ? ?????? ?? ??????? ? ??????????

### ??????: "????? ?? ????? ??????? ???????? ??? ??????????? ???????????"

**?????:** ? ??, ??? ??????? ??????????

**????????? ?????? ? ?????:** `TELEMETRY_COMPATIBILITY_ANALYSIS.md`

| ??????? | ???????? ? ??????????? | ????????? ????????? |
|---------|------------------------|---------------------|
| GetVehiclePreviousLapTime() | ? ?? | ? ??? |
| GetVehicleDeltaTime() | ? ?? | ? ??? |
| GetVehicleCurrentLapNumber() | ? ?? | ? ??? |
| g_focused_vehicle_id | ? ?? | ? ??? |
| RaceManager lap timing | ? ?? | ?? ????? m_track_progress |

**??? ????? ???????? ??? ???????? ??????????:**

1. **Client.cpp - ???????? ????? ?? ???????:**
```cpp
// ????? ????????? TelemetryPacket:
std::lock_guard<std::mutex> lock(g_vehicles_mutex);
auto it = g_vehicles.find(pData->ID);

if (it == g_vehicles.end()) {
    g_vehicles[pData->ID] = Vehicle(*pData); // ??? ????????!
} else {
    Vehicle& vehicle = it->second;
    vehicle.m_prev_x = vehicle.m_normalized_x;
    vehicle.m_prev_y = vehicle.m_normalized_y;
    
    // ????????? GPS, ???????????? ? normalized_x/y
    // ????????? m_track_progress
}
```

2. **?????????? m_track_progress ?? GPS ?????????**
   - ? ?????????: ??????????? ?????????????
   - ??? ???????? ??????: ????? ??????? CalculateProgressAlongTrack()

---

## 4. ? ??? ????????? TIME DIFF ? ????????? ??????

### ???? Delta ? ???????????????? ??????:

#### A. **Personal Best Delta** (??????? ??????????) ?
```
Delta = Current Lap Time - Best Lap Time
```
- ?????????? ????? ?????????? ?????
- ??????? ??????????
- ?????????? ??? ??????? ??????????

#### B. **Live Sector Delta** ? (F1, MotoGP)
- ?????? ??????? ?? 3 ???????
- Delta ??????????? ??? ??????????? ???????
- ?????????? ??? ??????? ?????

**??????:**
```
Sector 1: -0.233 ?? (???????!)
Sector 2: +0.664 ?? (?????????)
Sector 3: ... (? ????????)
Total: +0.431 (???????)
```

#### C. **Real-Time Point-by-Point Delta** ?? (iRacing, ACC)
- Delta ??????????? ?????? ????
- ?????????? ?? ?????? ????? ??????
- ????? ?????? ???????

**??????:**
```
?? ???????? ????? (progress 0.5):
  Current time: 41.890s
  Reference time: 41.728s
  Delta: +0.162s ??
```

### ???????????? ?? ??????????:

**??? ??????????:** Sector-based delta (3 ???????)
- ?????? ???????? ? ????????
- ?? ??????????? ???????
- ???????????? ? ???????? ??????

**??? pro-??????:** Point-by-point delta
- ????? ??????
- ??? ? ??????????? ?????? AAA
- ??????? ?????? ??????

**????????? ????????????:** `TELEMETRY_COMPATIBILITY_ANALYSIS.md`

---

## 5. ?? SUMMARY ?????????

### ???????? ??????: 2

1. **OpenGL\src\vehicle\Vehicle.cpp**
   - ????????? ?????? ???????? ??????????? (??? ???????????)
   - ?????? ?????????? m_smoothed_rotation (?????? ?? ????????????)

2. **OpenGL\src\racing\RaceManager.cpp**
   - ???? ?????? ????????????? (????????? LAP_START_NUMBER)
   - ?????????? ???????? ????? ?????

### ??????? ??????: 1

1. **TELEMETRY_COMPATIBILITY_ANALYSIS.md**
   - ?????? ?????? ????????????? ? ???????? ???????????
   - ??????? ???? ??? ?????????? Client.cpp
   - ?????????? ?????? delta ? ???????????????? ??????
   - ???????????? ?? ??????????

---

## 6. ? ???????? ??????????

```
Build successful
```

? ??? ????????? ?????????????? ???????
? ??? ????? ? ?????????????

---

## 7. ?? ??? ?????? ????????

### ??????? ??????? (?????? ? ?????????????):

? **??????????? ??????:**
- ????????? ?????????????? ? ??????????? ????????
- ?????? ???????? ??? ???????????
- ????????? ??????????

? **Lap Timer:**
- ????????????? ??????????? ????????? ?????? ??? ??????
- ??????????: Current, Previous, Best, Delta
- ??????????? ?????? ????

? **??????? ?????? ??????:**
- P ? ???? ID (????? ?????????? ????) ? ENTER
- ???????????? ID ?? 1 ?? 999+
- ?????????????? ????????????

? **????????????? ????:**
- ????????? LAP_START_NUMBER ?? Config.h
- ?????????? ???????? ?????? ??????
- ?? ??????? ?? ?????? ?????????

? **????????????? ? ???????????:**
- ??? ??????? ?????? ? ???????? ??????
- ????? ?????? ?????????? ? Client.cpp
- ???????????? ? ????????? ???? ??????

---

## 8. ?? ????????? ???? (???????????)

### ??? ?????? ?????????? ???????? ??????????:

1. **???????? ? Client.cpp:**
   - ????????/?????????? g_vehicles ?? TelemetryPacket
   - ?????????? m_track_progress ?? GPS

2. **??????????? - Live Delta:**
   - ??????????? sector-based delta (3 ???????)
   - ?????????? ????? ???????? ? UI
   - ????????? ? ???????? ???????

**??? ??????? ???? ?:** `TELEMETRY_COMPATIBILITY_ANALYSIS.md`

---

## ?? ??????!

??? ??????????? ????????? ?????????:
- ? ????????? ?????? ???????? ???????????
- ? ?????????? ???? (?????????????)
- ? ????????? ????????????? ? ???????????
- ? ???????? ????????? ??? ????????? time diff ? ??????
- ? ????????????? ??????? ???? ??? ?????????

**??? ????????????? ? ????? ? ?????????????!** ??
