# ?? ??????????? ????????? - ??????????? ?? ???????

## ? ??? ???? ??????????

### 1. **???????? ??????** ??
**????:** ???? 8080 ????? ?????? ???????????  
**???????:** ??????? ?? ???? **8081**

```cpp
// ? main.cpp:
const uint16_t SERVER_PORT = 8081;
StartGlobalHttpServer(&venchileManager, SERVER_PORT);
```

---

### 2. **?????? TelemetryServer** ???
**????:** ??? ??????? ???????? ???????????? ???? ????  
**???????:** ???????? ?????? GlobalHttpServer

```cpp
// ? ???????:
#include "TelemetryServer.h"
TelemetryServer telemetryServer;
telemetryServer.Stop();

// ? ?????????:
#include "Server.h"
StartGlobalHttpServer(&venchileManager, 8081);
```

---

### 3. **?????? ?????? ?????? ??????????????** ??
**????:** ?????? ?? ?????????????? ??? ?????????? ?????  
**???????:** ????????? ?????? ????????

```cpp
// ? main.cpp render loop:
venchileManager.RenderVenchiles(true);  // ?????? ??????

// ? Venchile.cpp:
void VenchileManager::RenderVenchiles(bool trackLoaded)
{
    // ??????? ????????:
    // if (!trackLoaded) return;
    
    // ?????? ?????? ???? ???? ??????
    if (!venchiles.empty()) {
        // ... draw
    }
}
```

---

### 4. **????????? ????????????? Origin** ??
**????:** Origin ?????????? ????? ???? (0, 0)  
**???????:** ?????????????? ?????????????

```cpp
// ? main.cpp:
if (jsonClass.input_latitude == 0.0 && jsonClass.input_longitude == 0.0)
{
    jsonClass.input_latitude = 56.9496;   // Riga, Latvia
    jsonClass.input_longitude = 24.1052;
    CordinateToMetersUTM(...);
}
```

---

### 5. **???????? ???????????** ??
**????????? debug ?????? ?? ???? ??????????? ??????:**

- **Server.cpp:** ?????? ???????? JSON, ?????? ??????
- **Venchile.cpp:** ?????????? ?????, ??????????, ??????????
- **main.cpp:** ?????????? ???????? ?????, ?????? ?????

---

## ?? ??? ?????????

### ??? 1: ???????????????? ??????

```bash
cd C:\Users\gamer\source\repos\OpenGL
msbuild OpenGL.sln /p:Configuration=Debug /p:Platform=x64 /t:Rebuild
```

### ??? 2: ????????? ??????????

```bash
.\x64\Debug\OpenGL.exe
```

**????????? ?????:**
```
========================================
   RaceMap - Starting Application
========================================

[Init] Checking origin coordinates...
[Init] Origin coordinates:
  Latitude:  56.9496
  Longitude: 24.1052
  Easting:   <number>
  Northing:  <number>

[Server] Starting Global HTTP Server on port 8081...

???????????????????????????????????????????????????????????????
  ?? GLOBAL HTTP SERVER - ACCESSIBLE FROM ANYWHERE
???????????????????????????????????????????????????????????????

?? SERVER STATUS: RUNNING
?? Port: 8081

?? LOCAL NETWORK ACCESS:
   Local IP:  192.168.x.x
   Full URL:  http://192.168.x.x:8081/telemetry

[Main] ? Global HTTP server started successfully on port 8081!
[Main] Server is ready to accept connections from ANYWHERE
[Main] Configure OwnTracker: http://YOUR_PUBLIC_IP:8081/telemetry
```

### ??? 3: ????????? ?????? (Port Forwarding)

**???????? ???? ?? 8081:**
```
External Port: 8081 (???? 8080)
Internal IP:   192.168.x.x
Internal Port: 8081
Protocol:      TCP
```

### ??? 4: ????????? Firewall

```powershell
# ??????? ?????? ??????? ??? ????? 8080
Remove-NetFirewallRule -DisplayName "RaceMap Global Server" -ErrorAction SilentlyContinue

# ???????? ????? ??? ????? 8081
New-NetFirewallRule -DisplayName "RaceMap Server 8081" `
    -Direction Inbound `
    -LocalPort 8081 `
    -Protocol TCP `
    -Action Allow `
    -Profile Any
```

### ??? 5: ????????? OwnTracker

**? ?????????? OwnTracker:**
```
Server URL:  http://YOUR_PUBLIC_IP:8081/telemetry
Method:      POST
Format:      JSON
Interval:    1 second
? Enable Server Upload
```

### ??? 6: ????????????

#### ????????? ????:
```bash
curl http://localhost:8081/status
```

**????????? ?????:**
```json
{
  "status": "online",
  "server": "RaceMap Global Telemetry Server",
  "version": "1.0.0",
  "vehicles": 0,
  "timestamp": 1234567890
}
```

#### ???????? ???????? ??????:
```bash
curl -X POST http://localhost:8081/telemetry -H "Content-Type: application/json" -d "{\"id\":\"test_car\",\"lat\":569496000,\"lon\":241052000,\"speed\":1500,\"course\":9000,\"fixType\":3,\"sats\":12}"
```

**??? ?????? ?????????:**
```
[Server] ===== Processing Telemetry =====
[Server] JSON length: 123 bytes
[Server] Format: OwnTracker
[Server] Parsed: test_car @ (56.9496, 24.1052) speed=15.0 m/s

[Vehicle] Processing telemetry for: test_car
          GPS: (56.9496, 24.1052)
          Speed: 15 m/s, Course: 90°
[Vehicle] ? NEW vehicle added: test_car at pos(0.0, 0.0) Total vehicles: 1

[Render] Drawing 1 vehicle(s) | Track: NOT LOADED
```

---

## ?? ???????

### ????????: ?????? ?? ???????????

**????????? ????:**
```powershell
netstat -ano | findstr :8081
```

**???? ?????:**
```powershell
# ??????? PID ? ????????? ???????
taskkill /PID <PID> /F

# ??? ???????? ???? ? main.cpp ?? ?????? (????????, 9000)
```

---

### ????????: ?????? ?? ????????

**????????? ???? ???????:**
- ???? ?? `[Connection]` ??????????
- ???? ?? `[Server] Processing Telemetry`?

**???? ??? ???????????:**
1. ????????? Port Forwarding ?? ???????
2. ????????? Firewall: `Test-NetConnection -ComputerName YOUR_IP -Port 8081`
3. ????????? URL ? OwnTracker

**???? ??????????? ????, ?? ??? ??????:**
1. ????????? ?????? JSON (??. ???? `[Server] Format:`)
2. ????????? ?????? ????????

---

### ????????: ?????? ?? ?????

**????????? ??????????:**
```
[Vehicle] at normalized pos(X, Y)
```

**???? X ? Y ??????? ??????? (>10):**
- Origin ?????????? ????????????
- ?????? ??????? ?????? ?? origin
- **???????:** ???????? origin ? main.cpp ?? ?????????? ?????? ?????

**???? ?????????? ??????????, ?? ?? ?????:**
1. ????????? GPS fix: `fixType` ?????? ???? > 0
2. ????????? ??????? ?????? (zoom)
3. ?????????? ??????????? ?????? (WASD)

---

### ????????: Origin ????????????

**??? ?????????? ?????????? origin:**

1. ???????? ?????????? ?????? ?????? ????? (?? OwnTracker ??? Google Maps)

2. ? `main.cpp`, ????????:
```cpp
if (jsonClass.input_latitude == 0.0 && jsonClass.input_longitude == 0.0)
{
    // ???????? ???? ??????????:
    jsonClass.input_latitude = 56.9496;   // ???? ??????
    jsonClass.input_longitude = 24.1052;  // ???? ???????
    CordinateToMetersUTM(jsonClass.input_latitude, jsonClass.input_longitude, 
                         jsonClass.easting, jsonClass.northing);
}
```

3. ???????????????? ? ?????????????

---

## ?? ????????? ?????????

### ??? ???????:
1. ? ?????? ??????????? ?? ????? 8081
2. ? ????????? ?????????? ?? origin
3. ? ???????????? Local IP ? ??????????

### ??? ??????????? OwnTracker:
1. ? `?? [Connection] <IP>:<PORT>`
2. ? `[Server] Processing Telemetry`
3. ? `[Server] Format: OwnTracker`
4. ? `[Vehicle] NEW vehicle added`

### ??? ?????????:
1. ? `[Render] Drawing N vehicle(s)`
2. ? ?????? ????? ??? ??????? ?????
3. ? ?????? ??????? ??????????? ???????

### ??? ????????:
1. ? ?????????? ??????????? ? real-time
2. ? ???????? ???????????? ? ?????
3. ? ???? ?? ????? (path) ?? ???????

---

## ?? CHECKLIST

- [ ] ?????? ????????????????
- [ ] ?????????? ????????
- [ ] ?????? ????????? ?? ????? 8081
- [ ] Origin ???????????????
- [ ] Port Forwarding ???????? (8081)
- [ ] Firewall ????????? ???? 8081
- [ ] OwnTracker ???????? (???? 8081)
- [ ] ???? curl ???????
- [ ] ?????? ???????? (????????? ? ?????)
- [ ] ?????? ??????????????

---

## ?? ??????? ??????

### ??????? ??? ????????:

```powershell
# ???? ??????
netstat -ano | findstr :8081

# Firewall ?????????
Get-NetFirewallRule -DisplayName "*RaceMap*" | Format-Table Name, Enabled

# ????????? ????:
curl http://localhost:8081/status

# ???????? ????-??????:
Invoke-RestMethod -Uri "http://localhost:8081/telemetry" -Method POST -ContentType "application/json" -Body '{"id":"test","lat":569496000,"lon":241052000,"speed":1000,"course":0,"fixType":3,"sats":10}'
```

### ???? ?????? ?? ????????:

1. **???????? ????:**
   - ?????????? ???? ????? ???????
   - ???????? OwnTracker ????????
   - ????????? `netstat -ano | findstr :8081`

2. **????????? ??????:**
   - ?????? ????????
   - OwnTracker ?????????? ??????? (????????? ? ????? ??????????)
   - ???????? ?????????

3. **?????????? ????:**
   - ??????????? Python ?????? `test_telemetry.py`
   - ???????? URL ?? `http://localhost:8081/telemetry`
   - ?????????: `python test_telemetry.py`

---

## ?? ?????!

???? ?? ??????:
```
[Vehicle] NEW vehicle added: <id> at pos(X, Y) Total vehicles: 1
[Render] Drawing 1 vehicle(s) | Track: NOT LOADED
```

**??????????! ??????? ????????!** ??

?????? ?? ??????:
- ? ???????? ?????? ? ????????
- ? ???????? ?????? ? LORA (????? Python ??????)
- ? ?????? ?????? ? ???????? ???????
- ? ??????????? ????????? ????????? ????????????

---

**????????? ???:** ????????? ???? (???????? ?????), ? ?????? ????? ?????????????? ?? ?????!

**????? ? ?????? ???????!** ??????
